# Nginx configuration for Vue.js Single Page Application (SPA)
# This config is designed to run inside a Docker container serving the built Vue.js app
#
# Key responsibilities:
# 1. Serve static assets (HTML, JS, CSS, images) from the build output
# 2. Handle client-side routing by falling back to index.html for all routes
# 3. Implement performance optimizations (gzip compression, caching)
# 4. Apply security headers to protect against common web vulnerabilities
# 5. Deny access to sensitive hidden files
#
# This configuration assumes the Vue.js app is built and copied to /usr/share/nginx/html
# in the Docker container, which is the standard nginx Docker image location.

server {
    # Listen on port 80 (HTTP) - in production, this would typically be behind
    # a reverse proxy (like the main nginx) that handles HTTPS termination
    listen 80;

    # Server name for this virtual host - localhost is used for development/container contexts
    server_name localhost;

    # Document root where the built Vue.js application files are located
    # This path is standard for the nginx Docker image
    root /usr/share/nginx/html;

    # Default file to serve when a directory is requested
    # For SPAs, this is typically the main index.html file
    index index.html;

    # Enable gzip compression to reduce bandwidth usage
    # This is critical for a Vue.js SPA as it significantly reduces bundle sizes
    gzip on;
    # Specify which MIME types should be compressed
    # text/css: CSS files, application/javascript: JS bundles
    # application/json: API responses, image/svg+xml: SVG assets
    gzip_types text/css application/javascript application/json image/svg+xml;
    # Compression level (1-9): 6 provides good balance between compression ratio and CPU usage
    # Higher levels provide diminishing returns for the extra CPU cost
    gzip_comp_level 6;

    # Security headers - essential for protecting against common web vulnerabilities
    # Prevent clickjacking attacks by denying the page from being embedded in frames/iframes
    add_header X-Frame-Options DENY always;
    # Prevent MIME type sniffing attacks by forcing browsers to respect declared content types
    add_header X-Content-Type-Options nosniff always;
    # Enable XSS protection in browsers that support it (legacy header, modern CSP is preferred)
    add_header X-XSS-Protection "1; mode=block" always;

    # Main app - handle client-side routing for Vue.js SPA
    location / {
        # This is the critical SPA routing configuration
        # try_files attempts to serve files in this order:
        # 1. $uri - exact file path (for actual files)
        # 2. $uri/ - directory with trailing slash
        # 3. /index.html - fallback for all client-side routes
        # This ensures Vue Router can handle all routes on the client side
        try_files $uri $uri/ /index.html;

        # Nested location for static asset caching - inherits parent location behavior
        # Regular expression matches common static file extensions
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
            # Cache static assets for 1 year since they should be versioned/hashed
            expires 1y;
            # Mark as public (can be cached by CDNs) and immutable (never changes)
            # This maximizes caching efficiency for bundled assets
            add_header Cache-Control "public, immutable";
        }
    }

    # Security: Disable access to hidden files and directories
    # This prevents access to sensitive files like .env, .git, .htaccess, etc.
    # The regex ~ /\. matches any path containing a dot after a slash
    location ~ /\. {
        deny all;
    }
}